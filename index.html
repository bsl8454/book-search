async function searchBooks() {
    const query = document.getElementById('searchQuery').value.trim();
    const resultsContainer = document.getElementById('results');
    
    if (!query) {
        alert('검색어를 입력해주세요!');
        return;
    }

    resultsContainer.innerHTML = '<p>검색 중입니다...</p>';

    // 구글 시트 직통 주소 (관장님 시트 전용)
    const url = 'https://docs.google.com/spreadsheets/d/1V9GGjLnsHGWjJu-GT__MlgX3ZXSeHvwIsEYDIbEjpxw/gviz/tq?tqx=out:json&gid=2045470469';

    try {
        const response = await fetch(url);
        const text = await response.text();
        // 구글 응답 데이터에서 JSON 부분만 추출
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const rows = json.table.rows;

        const results = rows
            .map(row => ({
                title: row.c[1] ? row.c[1].v : '', // B열: 제목
                author: row.c[2] ? row.c[2].v : '', // C열: 저자
                publisher: row.c[3] ? row.c[3].v : '', // D열: 출판사
                image: row.c[6] ? row.c[6].v : '' // G열: 이미지 URL
            }))
            .filter(book => book.title.includes(query) || book.author.includes(query));

        displayResults(results);
    } catch (error) {
        console.error('Error:', error);
        resultsContainer.innerHTML = '<p>데이터를 불러오는 데 실패했습니다. 잠시 후 다시 시도해주세요.</p>';
    }
}

function displayResults(results) {
    const resultsContainer = document.getElementById('results');
    resultsContainer.innerHTML = '';

    if (results.length === 0) {
        resultsContainer.innerHTML = '<p>검색 결과가 없습니다.</p>';
        return;
    }

    results.forEach(book => {
        const div = document.createElement('div');
        div.className = 'book-item';
        div.innerHTML = `
            <img src="${book.image}" alt="${book.title}" onerror="this.src='https://via.placeholder.com/100x150?text=No+Image'">
            <div class="book-info">
                <div class="book-title">${book.title}</div>
                <div class="book-author">${book.author} | ${book.publisher}</div>
            </div>
        `;
        resultsContainer.appendChild(div);
    });
}
